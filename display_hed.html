<html>
<head>
<link rel="stylesheet" type="text/css" href="hed-collapsible.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script>
function loadXMLDoc(filename)
{
if (window.ActiveXObject)
  {
  xhttp = new ActiveXObject("Msxml2.XMLHTTP");
  }
else
  {
  xhttp = new XMLHttpRequest();
  }
xhttp.open("GET", filename, false);
try {xhttp.responseType = "msxml-document"} catch(err) {} // Helping IE11
xhttp.send("");
return xhttp.responseXML;
}
function displayResult()
{
xml = loadXMLDoc("test_visualization/HED.xml");
xsl = loadXMLDoc("test_visualization/hed-schema.xsl");
// code for IE
if (window.ActiveXObject || xhttp.responseType == "msxml-document")
  {
  ex = xml.transformNode(xsl);
  document.getElementById("example").innerHTML = ex;
  }
// code for Chrome, Firefox, Opera, etc.
else if (document.implementation && document.implementation.createDocument)
  {
  xsltProcessor = new XSLTProcessor();
  xsltProcessor.importStylesheet(xsl);
  resultDocument = xsltProcessor.transformToFragment(xml, document);
  document.getElementById("example").appendChild(resultDocument);
  }
$('li').css('cursor', 'pointer');
$("li").click(function(event) {
    var selected = $(event.target);
    var attrs = selected.children("div").text();
    parsed = attrs.split(',');
    parsed = parsed.map(x => "<p>" + x.trim() + "</p>");
    parsed = parsed.slice(0,parsed.length-1); // last item is empty (result of extra , at the end)
    var finalText = parsed.join("");
    finalText = finalText == null || finalText.length == 0 ? "" : "<p><i>Attribute</i></p>"+finalText;
    $("div.tooltip > h3").text(selected
        .clone()    //clone the element
        .children() //select all the children
        .remove()   //remove all the children
        .end()  //again go back to selected element
        .text());
    $("div.tooltip > p#description").text(selected.attr("description"));
    $("div.tooltip > div#attribute").html(finalText);
    $("div.tooltip").css({
        top: selected.offset().top + "px",
        left: selected.offset().left + selected.textWidth() + 10 + "px"
    }).show();
})
$('.close').on('click', function(){
  $("div.tooltip").fadeOut();
});

$.fn.textWidth = function(){
  // Credit: https://stackoverflow.com/questions/1582534/calculating-text-width
  var html_org = $(this).html();
  var html_calc = '<span>' + html_org + '</span>';
  $(this).html(html_calc);
  var width = $(this).find('span:first').width();
  $(this).html(html_org);
  return width;
};
}
</script>
<script>
</script>
</head>
<body onload="displayResult()">
<h1>HED Schema</h1>
<ul id="example" class="collapsibleList"></ul>
<div class="tooltip">
    <span class="close" style="position:relative; float:left">X</span>
    <h3>Tooltip title</h3>
    <p id="description"></p>
    <p>--------</p>
    <div id="attribute"></div>
    
</div>
</body>
</html>

